define("components/biWaterfallPlugin",["base/MoGu","components/waterfall"],function(e,n){function t(e){if(""==e)return"";var n,t,r,o,i={},a=e.indexOf("?")+1,f=-1==e.indexOf("#")?e.length:e.indexOf("#"),c=e.slice(a,f),s=c.split("&");for(r=0,o=s.length;o>r;r++){var u=s[r].indexOf("=");if(u>0){n=s[r].substring(0,u),t=s[r].substr(u+1);try{t.indexOf("+")>-1&&(t=t.replace(/\+/g," ")),i[n]=decodeURIComponent(t)}catch(l){}}}return delete i.frm,i}function r(e,n,t){var r,o,i=[],a=function(e,n,t){var r,o=[];if(n===!0?n="1":n===!1&&(n="0"),null!=n){if("object"==typeof n){for(r in n)null!=n[r]&&o.push(a(e+"["+r+"]",n[r],t));return o.join(t)}if("function"!=typeof n)return encodeURIComponent(e)+"="+encodeURIComponent(n);throw new Error("There was an error processing for http_build_query().")}return""};t||(t="&");for(o in e)if(e.hasOwnProperty(o)){r=e[o],n&&!isNaN(o)&&(o=String(n)+o);var f=a(o,r,t);""!==f&&i.push(f)}return i.join(t)}function o(e){var n,t,r=e._config,o=r.onLayoutFinished,a=e.destroy,l="scroll.biwaterfall-"+e._id;return _.on(A,i),_.on(l,function(){E.scroll=_.scrollTop(),d(n)}),e.start=function(){return e},O=e.$el.offset().top,n=e._config=w.extend(e._config,{canFetch:p,onFetchStart:function(e){e.data.frame=I,e.data.page=I+1,k=!1},onLayoutFinished:function(){E.height=this.$el.height(),d(n),u(),k=!0,y=x.getColsHistoryInfo(),s(),K&&(K=!1,b=_.height(),N=b/2,setTimeout(function t(){x.triggerScroll(j.shift()),I||H?j.length&&(K=!0):(H=!0,t())},0),setTimeout(function(){_.triggerHandler(F)},50)),o&&o.apply(e,arguments)},onFetchError:function(){k=!0}}),t=g(C.search),E=w.extend({},E,t),n.defaultScrollData?c(n.defaultScrollData):t.remember||c(),n.sessionKey=m(),f(),d(n),e.destroy=function(){a.call(e),_.off(l)},e}function i(){y=[],c()}function a(e){var n=!!e.length;return e.forEach(function(e){return e?void 0:n=!1}),n}function f(){x._config.forceClearBackup&&l(),y=h();var e,n,t=x.$el,r=+E.height,o=+E.scroll,i=+E.frame,f=y.length;I=i,s(),a(y)?(0!=r&&t.height(r),0!=o&&window.scrollTo(0,o)):(f=0,c()),i&&f&&(x.setColsHistoryInfo(y),n=i>=f?f-1:i,e=y[n],x.setColsInfo(y[i-1]),S[n]=e.sort(function(e,n){return n.max-e.max})[0].max),x.fetch()}function c(e){var n=g(C.search);E=w.extend({},n,{scroll:0,frame:0,page:1,height:0,remember:1},e),I=0,window.scrollTo(0,E.scroll),d(x._config),l()}function s(){y.forEach(function(e,n){e&&(S[n]=e.sort(function(e,n){return n.max-e.max||e.left-n.left})[0].max)})}function u(){try{sessionStorage.setItem(x._config.sessionKey,JSON.stringify(x.getColsHistoryInfo()))}catch(e){}}function l(){try{sessionStorage.removeItem(x._config.sessionKey)}catch(e){}}function h(){var e=sessionStorage.getItem(x._config.sessionKey);return e?JSON.parse(e):[]}function g(e){return t(e)||{}}function d(e){e.isAutoUpdateURL&&history.replaceState(null,"","?"+r(E)+C.hash)}function m(){var e=x._config.keywords,n=C.pathname,t=n.length,r=g(C.search),o="";if("/"==n[t-1]&&(n=n.substring(1,t-1)),e){if("function"==typeof e)return T+n+"?"+e();Array.isArray(e)||(e=[e]),e.forEach(function(e){var n,t,i;e&&("object"==typeof e?(n=e.keyword,i=e["default"]):n=e,t=r[n]||i,t&&(o+=n+"="+t+"&"))}),o&&(n+="?"+o.substring(0,o.length-1))}return T+n}function p(e,n){var t,r=e-O,o=S.length,i=y[I];if(i=i?{min:i[0].min,max:i[0].max}:{min:0,max:0},k)for(;o--;)S[o]-N>r&&(I=E.frame=o,E.page=o+1);return n?i.max-b-r<N&&k&&(I++,x.updateLayoutDirection(L)):i.min>0&&r-i.min<2*N&&k&&(I--,0>I&&(I=0),x.updateLayoutDirection(U)),t=!x.isFrameLoaded(I),k&&t}var y,x,v=window,w=v.$,C=v.location,_=w(v),b=_.height(),E={scroll:0,frame:0,page:1,height:0,remember:1},S=[],O=0,I=0,R=n.CONS,L=R.NORMAL,U=R.REVERSE,A=R.EVENT_CLEAR_BACKUP,F=R.FORCE_CHECK,N=b/2,T="waterfall-cache:",K=!0,k=!0,H=!1,j=["up","down"],B={forceClearBackup:!1,isAutoUpdateURL:!0};return{init:function(e){return e.isBiWaterfall=!0,o(x=n.init(w.extend({},B,e)))},takeOver:!0,reset:c}});